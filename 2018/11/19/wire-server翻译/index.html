<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/blog/img/favicon.ico">

    <title>
        
        wire-server翻译 - undefined
        
    </title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/blog/css/aircloud.css">
    <link rel="stylesheet" href="/blog/css/gitment.css">
    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
</head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i> 我，Lionel Messi，我不是天生强大，我只是天生要强。 </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar">
            <img src="/blog/img/photo.png" />
        </div>
        <div class="name">
            <i>不负如来不负卿</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/blog/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>主页</span>
                </a>
            </li>
            <li >
                <a href="/blog/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>标签</span>
                </a>
            </li>
            <li >
                <a href="/blog/archive">
                    <i class="iconfont icon-guidang2"></i>
                    <span>存档</span>
                </a>
            </li>
            <li >
                <a href="/blog/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>关于</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>搜索</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#仓库内容"><span class="toc-text">仓库内容</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#services-服务"><span class="toc-text">services(服务)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tools-工具"><span class="toc-text">tools(工具)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#libs-库"><span class="toc-text">libs(库)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#其他"><span class="toc-text">其他</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#架构概述"><span class="toc-text">架构概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Development-setup-开发设置"><span class="toc-text">Development setup(开发设置)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#如何构建wire-server二进制文件"><span class="toc-text">如何构建wire-server二进制文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#如何运行集成测试"><span class="toc-text">如何运行集成测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#如何使用”假”的外部依赖运行wire-server"><span class="toc-text">如何使用”假”的外部依赖运行wire-server</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#如何使用真实的AWS服务运行wire-server"><span class="toc-text">如何使用真实的AWS服务运行wire-server</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Roadmap-路线图"><span class="toc-text">Roadmap(路线图)</span></a></li></ol></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">搜索</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>
        <div class="index-about-mobile">
            <i> 我，Lionel Messi，我不是天生强大，我只是天生要强。 </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        wire-server翻译
    </div>

    <div class="post-meta">
        <span class="attr">发布于：<span>2018-11-19 21:19:20</span></span>
        
        </span>
        <span class="attr">访问：<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content ">
        <h3 id="仓库内容"><a href="#仓库内容" class="headerlink" title="仓库内容"></a>仓库内容</h3><p>这个仓库包含一下源代码：</p>
<h4 id="services-服务"><a href="#services-服务" class="headerlink" title="services(服务)"></a>services(服务)</h4><ul>
<li>nginz: 反向代理公共API（带有libzauth自定义模块的Nginx）</li>
<li>galley: 会话和团队</li>
<li>brig: 账户</li>
<li>gundeck: 推送通知中心</li>
<li>cannon: WebSocket推送通知</li>
<li>cargohold: 资产(图像，文件…)存储</li>
<li>proxy: 集成第三方API</li>
<li>restund: 用于音频/视频通话的STUN/TURN服务器</li>
</ul>
<h4 id="tools-工具"><a href="#tools-工具" class="headerlink" title="tools(工具)"></a>tools(工具)</h4><ul>
<li>api-simulations: 自动化运行冒烟和负载测试 </li>
<li>makedeb: 创建Debian软件包</li>
<li>bonanza: 转换和转发日志数据</li>
<li>db/: 迁移工具(例如: 当添加新的表时)</li>
</ul>
<h4 id="libs-库"><a href="#libs-库" class="headerlink" title="libs(库)"></a>libs(库)</h4><ul>
<li>共享库</li>
</ul>
<h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><ul>
<li>build: 为某些平台构建脚本和Dockerfiles</li>
<li>deploy: (正在进行中)-如何在短暂的内存演示模式下运行wire-server</li>
<li>doc: 文档</li>
</ul>
<h3 id="架构概述"><a href="#架构概述" class="headerlink" title="架构概述"></a>架构概述</h3><p>下图提供了构成Wire Server的组件（部署）体系结构的高级概述，以及组件之间主要的内部和外部依赖关系。<br><img src="img/main.png" alt=""><br>内部组件之间的通信目前没有通过专用认证或加密来保护，并且被假定为局限于专用网络。</p>
<h3 id="Development-setup-开发设置"><a href="#Development-setup-开发设置" class="headerlink" title="Development setup(开发设置)"></a>Development setup(开发设置)</h3><h4 id="如何构建wire-server二进制文件"><a href="#如何构建wire-server二进制文件" class="headerlink" title="如何构建wire-server二进制文件"></a>如何构建wire-server二进制文件</h4><p>两种方式：</p>
<ul>
<li>本地编译源代码<br>这需要一系列依赖于您的平台/操作系统的依赖关系，例如：<ul>
<li>Haskell 和Rust编译器和包管理器</li>
<li>依赖于你的平台/操作系统的一些依赖包(libsodium, openssl, protobuf, icu, geoip, snappy, cryptobox-c,)<br>查看依赖详情(doc/Dependencies.md)<br>设置好所有的依赖项后，下面的操作应该是成功的：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> build all haskell services</span><br><span class="line">make</span><br><span class="line"><span class="meta">#</span> build one haskell service, e.g. brig:</span><br><span class="line">cd services/brig &amp;&amp; make</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p>默认的make target（fast）编译未优化（编译时间更快，二进制文件更慢），这对于开发目的来说应该没问题。 使用make install获取优化的二进制文件。<br>对于编译nginz，请看(services/nginz/README.md)</p>
<ul>
<li>使用Docker<br>如果您不希望从头开始构建所有docker镜像(例如:alpine-builder需要很长时间),可以从此处下载现成的镜像。<br>如果你希望构建你自己的Docker镜像，你需要docker version &gt;= 17.05和make，然后执行:<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make docker-services</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>最终，它将构建一系列docker镜像，有关详细信息，请看Makefiles和Dockerfiles，以及build/alpine/README.md</p>
<h4 id="如何运行集成测试"><a href="#如何运行集成测试" class="headerlink" title="如何运行集成测试"></a>如何运行集成测试</h4><p>运行集成测试前，要求所有的haskell服务((brig,galley,cannon,gundeck,proxy,cargohold)都已经正确配置并且已启动，然后才能执行例如:brig-integration二进制文件。这要求在体系结构图中看到的大多数部署依赖项也都是可用的：</p>
<ul>
<li>必须的内部依赖项<ul>
<li>cassandra(使用正确的schema)</li>
<li>elasticsearch(使用正确的schema)</li>
<li>redis</li>
</ul>
</li>
<li>必须的外部依赖项是以下已经配置好的AWS服务(或提供相同API的假的配件)<ul>
<li>SES</li>
<li>SQS</li>
<li>SNS</li>
<li>S3</li>
<li>Cloudfront</li>
<li>DynamoDB<br>使用docker-compose设置这些真实的只是在内存中的内部和”假”的外部依赖是非常容易的。在一个单独的终端中运行以下命令(它将阻塞终端，使用C-c去关闭这些所有的docker镜像):<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deploy/docker-ephemeral/run.sh</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p>然后，运行所有的集成测试:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make integration</span><br></pre></td></tr></table></figure></p>
<p>或者，在顶级目录上进行make(生成所有服务的二进制文件)，然后执行例如: cd services/brig &amp;&amp; make integration 只运行一个服务的集成测试。</p>
<p>您可以使用$WIRE_STACK_OPTIONS通过Makefiles将参数传递给堆栈，这是很有用的，例如：传递参数到tasty，或者暂时禁用-Werror而不会有意外提交任何内容的风险，如下所示：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WIRE_STACK_OPTIONS='--ghc-options=-Wwarn --test-arguments="--quickcheck-tests=19919 --quickcheck-replay=651712"' make integration</span><br></pre></td></tr></table></figure></p>
<p>提示：<a href="https://github.com/feuerbach/tasty#runtime" target="_blank" rel="noopener">https://github.com/feuerbach/tasty#runtime</a></p>
<h4 id="如何使用”假”的外部依赖运行wire-server"><a href="#如何使用”假”的外部依赖运行wire-server" class="headerlink" title="如何使用”假”的外部依赖运行wire-server"></a>如何使用”假”的外部依赖运行wire-server</h4><p>看<a href="https://github.com/wireapp/wire-server/blob/develop/deploy/services-demo/README.md" target="_blank" rel="noopener">https://github.com/wireapp/wire-server/blob/develop/deploy/services-demo/README.md</a></p>
<h4 id="如何使用真实的AWS服务运行wire-server"><a href="#如何使用真实的AWS服务运行wire-server" class="headerlink" title="如何使用真实的AWS服务运行wire-server"></a>如何使用真实的AWS服务运行wire-server</h4><p>文档，配置和代码尚未完全准备好（请不要打开issue来询问这个问题！）。 有关如何运行有线服务器的更多信息将在不久的将来提供。<br>作为简要概述，他需要设置:</p>
<ul>
<li>数据库集群(cassandra, redis, elasticsearch)</li>
<li>外部依赖<ul>
<li>有权访问的亚马逊账户<ul>
<li>SES</li>
<li>SQS</li>
<li>SNS</li>
<li>S3</li>
<li>Cloudfront</li>
<li>DynamoDB</li>
</ul>
</li>
<li>Nexmo/Twilio账户(如果你想发送短信)</li>
<li>Giphy/Google/Spotify/Soundcloud API密钥(如果你希望通过代理这些服务来支持预览)</li>
<li>TURN服务(如果你希望支持语音/视频通话)</li>
</ul>
</li>
<li>所有服务的生产预备环境配置</li>
<li>其他基础架构配置(DNS, SSL certificates, metrics, logging, etc)</li>
</ul>
<h4 id="Roadmap-路线图"><a href="#Roadmap-路线图" class="headerlink" title="Roadmap(路线图)"></a>Roadmap(路线图)</h4><ul>
<li>部署选项</li>
</ul>

        
            <div class="donate-container">
    <div class="donate-button">
        <button id="donate-button">赞赏</button>
    </div>
    <div class="donate-img-container hide" id="donate-img-container">
        <img id="donate-img" src="" data-src="/blog/img/pay.png">
        <p> 感谢鼓励 </p>
    </div>
</div>
        
        <div id="comment-container">
        </div>
    </div>
</div>
    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        

        

    </ul>
    
    <p>
        <span>/</span>
        
        <span><a href="https://medium.com/netflix-techblog">Netflix</a></span>
        <span>/</span>
        
        <span><a href="https://engineering.linkedin.com/blog">linkedin</a></span>
        <span>/</span>
        
        <span><a href="https://blogs.dropbox.com/tech/">dropbox</a></span>
        <span>/</span>
        
        <span><a href="https://code.fb.com/">facebook</a></span>
        <span>/</span>
        
        <span><a href="https://github.com/limengyu1990/">Github</a></span>
        <span>/</span>
        
    </p>
    
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>
        Created By <a href="https://hexo.io/">Hexo</a>  Theme <a href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a></p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.json"
    window.hexo_root = "/blog/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="/blog/js/index.js"></script>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script src="/blog/js/gitment.js"></script>
<script>
    var gitment = new Gitment({
        id: 'wire-server翻译',
        owner: 'limengyu1990',
        repo: 'hexo-blog',
        oauth: {
            client_id: '7cfc73dd62b57f07ed83',
            client_secret: 'dd03b7e54aadf0d81e4c9c93e23a41272bcfcfa1',
        },
    })
    gitment.render('comment-container')
</script>

</html>
