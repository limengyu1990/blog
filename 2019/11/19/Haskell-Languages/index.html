<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/blog/img/favicon.ico">

    <title>
        
        Haskell-Languages - undefined
        
    </title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/blog/css/aircloud.css">
    <link rel="stylesheet" href="/blog/css/gitment.css">
    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
</head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i> 不会Haskell的Scala写不出好的JavaScript。 </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar">
            <img src="/blog/img/photo.png" />
        </div>
        <div class="name">
            <i>不负如来不负卿</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/blog/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>主页</span>
                </a>
            </li>
            <li >
                <a href="/blog/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>标签</span>
                </a>
            </li>
            <li >
                <a href="/blog/archive">
                    <i class="iconfont icon-guidang2"></i>
                    <span>存档</span>
                </a>
            </li>
            <li >
                <a href="/blog/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>关于</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>搜索</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Binder-Libraries"><span class="toc-text">Binder Libraries</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#unbound"><span class="toc-text">unbound</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#unbound-generics"><span class="toc-text">unbound-generics</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pretty"><span class="toc-text">pretty</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#wl-pprint-text"><span class="toc-text">wl-pprint-text</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pretty-show"><span class="toc-text">pretty-show</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Haskeline"><span class="toc-text">Haskeline</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Repline"><span class="toc-text">Repline</span></a></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">搜索</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>
        <div class="index-about-mobile">
            <i> 不会Haskell的Scala写不出好的JavaScript。 </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        Haskell-Languages
    </div>

    <div class="post-meta">
        <span class="attr">发布于：<span>2019-11-19 12:14:27</span></span>
        
        <span class="attr">标签：/
        
        <a class="tag" href="/blog/tags/#Wish-Knew" title="Wish-Knew">Wish-Knew</a>
        <span>/</span>
        
        <a class="tag" href="/blog/tags/#Haskell" title="Haskell">Haskell</a>
        <span>/</span>
        
        <a class="tag" href="/blog/tags/#Languages" title="Languages">Languages</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">访问：<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content ">
        <blockquote>
<p><a href="http://dev.stephendiehl.com/hask/#languages" target="_blank" rel="noopener">原文</a></p>
</blockquote>
<h3 id="Binder-Libraries"><a href="#Binder-Libraries" class="headerlink" title="Binder Libraries"></a>Binder Libraries</h3><ul>
<li><a href="https://nicolaspouillard.fr/publis/names-for-free.pdf" target="_blank" rel="noopener">Names for Free</a></li>
<li>Abstract Binding Trees</li>
<li>du Bruijn Indicies</li>
</ul>
<h3 id="unbound"><a href="#unbound" class="headerlink" title="unbound"></a>unbound</h3><p>由於它主要是机械的，因此存在几个庫来机械化书写名称<code>capture</code>(捕获)和<code>substitution</code>(替换)的过程，最强大的可能是<code>unbound</code>库。<br>例如，我们可以在简单类型的<code>lambda</code>演算上实现小型<code>Hindley-Milner</code>系统的推断函数，而不必自己编写名称捕获和替换机制。<br><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#123;-# LANGUAGE TemplateHaskell #-&#125;</span></span><br><span class="line"><span class="meta">&#123;-# LANGUAGE FlexibleInstances #-&#125;</span></span><br><span class="line"><span class="meta">&#123;-# LANGUAGE UndecidableInstances #-&#125;</span></span><br><span class="line"><span class="meta">&#123;-# LANGUAGE MultiParamTypeClasses #-&#125;</span></span><br><span class="line"><span class="meta">&#123;-# LANGUAGE OverloadedStrings #-&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> Infer <span class="keyword">where</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Data.String</span><br><span class="line"><span class="keyword">import</span> Data.Map (<span class="type">Map</span>)</span><br><span class="line"><span class="keyword">import</span> Control.Monad.Error</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">qualified</span> Data.Map <span class="keyword">as</span> Map</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">qualified</span> Unbound.LocallyNameless <span class="keyword">as</span> NL</span><br><span class="line"><span class="keyword">import</span> Unbound.LocallyNameless <span class="keyword">hiding</span> (<span class="type">Subst</span>, <span class="title">compose</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">data</span> <span class="type">Type</span></span></span><br><span class="line">  = <span class="type">TVar</span> (<span class="type">Name</span> <span class="type">Type</span>)</span><br><span class="line">  | <span class="type">TArr</span> <span class="type">Type</span> <span class="type">Type</span></span><br><span class="line">  <span class="keyword">deriving</span> (<span class="type">Show</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">data</span> <span class="type">Expr</span></span></span><br><span class="line">  = <span class="type">Var</span> (<span class="type">Name</span> <span class="type">Expr</span>)</span><br><span class="line">  | <span class="type">Lam</span> (<span class="type">Bind</span> (<span class="type">Name</span> <span class="type">Expr</span>) <span class="type">Expr</span>)</span><br><span class="line">  | <span class="type">App</span> <span class="type">Expr</span> <span class="type">Expr</span></span><br><span class="line">  | <span class="type">Let</span> (<span class="type">Bind</span> (<span class="type">Name</span> <span class="type">Expr</span>) <span class="type">Expr</span>)</span><br><span class="line">  <span class="keyword">deriving</span> (<span class="type">Show</span>)</span><br><span class="line"></span><br><span class="line">$(derive [''<span class="type">Type</span>, ''<span class="type">Expr</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">instance</span> <span class="type">IsString</span> <span class="type">Expr</span> <span class="keyword">where</span></span></span><br><span class="line">    fromString = <span class="type">Var</span> . fromString</span><br><span class="line"><span class="class"><span class="keyword">instance</span> <span class="type">IsString</span> <span class="type">Type</span> <span class="keyword">where</span></span></span><br><span class="line">    fromString = <span class="type">TVar</span> . fromString</span><br><span class="line"><span class="class"><span class="keyword">instance</span> <span class="type">IsString</span> (<span class="type">Name</span> <span class="type">Expr</span>) <span class="keyword">where</span></span></span><br><span class="line">    fromString = string2Name</span><br><span class="line"><span class="class"><span class="keyword">instance</span> <span class="type">IsString</span> (<span class="type">Name</span> <span class="type">Type</span>) <span class="keyword">where</span></span></span><br><span class="line">    fromString = string2Name</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">instance</span> <span class="type">Eq</span> <span class="type">Type</span> <span class="keyword">where</span></span></span><br><span class="line">    (==) = eqType</span><br><span class="line"></span><br><span class="line"><span class="title">eqType</span> :: <span class="type">Type</span> -&gt; <span class="type">Type</span> -&gt; <span class="type">Bool</span></span><br><span class="line"><span class="title">eqType</span> (<span class="type">TVar</span> v1) (<span class="type">TVar</span> v2) = v1 == v2</span><br><span class="line"><span class="title">eqType</span> _ _ = <span class="type">False</span></span><br><span class="line"></span><br><span class="line"><span class="title">uvar</span> :: <span class="type">String</span> -&gt; <span class="type">Expr</span></span><br><span class="line"><span class="title">uvar</span> x = <span class="type">Var</span> (s2n x)</span><br><span class="line"></span><br><span class="line"><span class="title">tvar</span> :: <span class="type">String</span> -&gt; <span class="type">Type</span></span><br><span class="line"><span class="title">tvar</span> x = <span class="type">TVar</span> (s2n x)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">instance</span> <span class="type">Alpha</span> <span class="type">Type</span></span></span><br><span class="line"><span class="class"><span class="keyword">instance</span> <span class="type">Alpha</span> <span class="type">Expr</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="keyword">instance</span> <span class="type">NL</span>.<span class="type">Subst</span> <span class="type">Type</span> <span class="type">Type</span> <span class="keyword">where</span></span></span><br><span class="line">  isvar (<span class="type">TVar</span> v) = <span class="type">Just</span> (<span class="type">SubstName</span> v)</span><br><span class="line">  isvar _ = <span class="type">Nothing</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">instance</span> <span class="type">NL</span>.<span class="type">Subst</span> <span class="type">Expr</span> <span class="type">Expr</span> <span class="keyword">where</span></span></span><br><span class="line">  isvar (<span class="type">Var</span> v) = <span class="type">Just</span> (<span class="type">SubstName</span> v)</span><br><span class="line">  isvar _ = <span class="type">Nothing</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">instance</span> <span class="type">NL</span>.<span class="type">Subst</span> <span class="type">Expr</span> <span class="type">Type</span> <span class="keyword">where</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">data</span> <span class="type">TypeError</span></span></span><br><span class="line">  = <span class="type">UnboundVariable</span> (<span class="type">Name</span> <span class="type">Expr</span>)</span><br><span class="line">  | <span class="type">GenericTypeError</span></span><br><span class="line">  <span class="keyword">deriving</span> (<span class="type">Show</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">instance</span> <span class="type">Error</span> <span class="type">TypeError</span> <span class="keyword">where</span></span></span><br><span class="line">  noMsg = <span class="type">GenericTypeError</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">type</span> <span class="type">Env</span> = <span class="type">Map</span> (<span class="type">Name</span> <span class="type">Expr</span>) <span class="type">Type</span></span></span><br><span class="line"><span class="class"><span class="keyword">type</span> <span class="type">Constraint</span> = (<span class="type">Type</span>, <span class="type">Type</span>)</span></span><br><span class="line"><span class="class"><span class="keyword">type</span> <span class="type">Infer</span> = <span class="type">ErrorT</span> <span class="type">TypeError</span> <span class="type">FreshM</span></span></span><br><span class="line"></span><br><span class="line"><span class="title">empty</span> :: <span class="type">Env</span></span><br><span class="line"><span class="title">empty</span> = <span class="type">Map</span>.empty</span><br><span class="line"></span><br><span class="line"><span class="title">freshtv</span> :: <span class="type">Infer</span> <span class="type">Type</span></span><br><span class="line"><span class="title">freshtv</span> = <span class="keyword">do</span></span><br><span class="line">  x &lt;- fresh <span class="string">"_t"</span></span><br><span class="line">  return $ <span class="type">TVar</span> x</span><br><span class="line"></span><br><span class="line"><span class="title">infer</span> :: <span class="type">Env</span> -&gt; <span class="type">Expr</span> -&gt; <span class="type">Infer</span> (<span class="type">Type</span>, [<span class="type">Constraint</span>])</span><br><span class="line"><span class="title">infer</span> env expr = <span class="keyword">case</span> expr  <span class="keyword">of</span></span><br><span class="line"></span><br><span class="line">  <span class="type">Lam</span> b -&gt; <span class="keyword">do</span></span><br><span class="line">    (n,e) &lt;- unbind b</span><br><span class="line">    tv &lt;- freshtv</span><br><span class="line">    <span class="keyword">let</span> env' = <span class="type">Map</span>.insert n tv env</span><br><span class="line">    (t, cs) &lt;- infer env' e</span><br><span class="line">    return (<span class="type">TArr</span> tv t, cs)</span><br><span class="line"></span><br><span class="line">  <span class="type">App</span> e1 e2 -&gt; <span class="keyword">do</span></span><br><span class="line">     (t1, cs1) &lt;- infer env e1</span><br><span class="line">     (t2, cs2) &lt;- infer env e2</span><br><span class="line">     tv &lt;- freshtv</span><br><span class="line">     return (tv, (t1, <span class="type">TArr</span> t2 tv) : cs1 ++ cs2)</span><br><span class="line"></span><br><span class="line">  <span class="type">Var</span> n -&gt; <span class="keyword">do</span></span><br><span class="line">     <span class="keyword">case</span> <span class="type">Map</span>.lookup n env <span class="keyword">of</span></span><br><span class="line">        <span class="type">Nothing</span> -&gt; throwError $ <span class="type">UnboundVariable</span> n</span><br><span class="line">        <span class="type">Just</span> t  -&gt; return (t, [])</span><br><span class="line"></span><br><span class="line">  <span class="type">Let</span> b -&gt; <span class="keyword">do</span></span><br><span class="line">     (n, e) &lt;- unbind b</span><br><span class="line">     (tBody, csBody) &lt;- infer env e</span><br><span class="line">     <span class="keyword">let</span> env' = <span class="type">Map</span>.insert n tBody env</span><br><span class="line">     (t, cs) &lt;- infer env' e</span><br><span class="line">     return (t, cs ++ csBody)</span><br></pre></td></tr></table></figure></p>
<h3 id="unbound-generics"><a href="#unbound-generics" class="headerlink" title="unbound-generics"></a>unbound-generics</h3><p>最近未绑定被移植为使用<code>GHC.Generics</code>而不是<code>Template Haskell</code>。<br>该<code>API</code>实际上是相同的，因此，例如，一个简单的<code>lambda</code>演算可以写为:</p>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#123;-# LANGUAGE DeriveGeneric #-&#125;</span></span><br><span class="line"><span class="meta">&#123;-# LANGUAGE DeriveDataTypeable #-&#125;</span></span><br><span class="line"><span class="meta">&#123;-# LANGUAGE FlexibleInstances #-&#125;</span></span><br><span class="line"><span class="meta">&#123;-# LANGUAGE FlexibleContexts #-&#125;</span></span><br><span class="line"><span class="meta">&#123;-# LANGUAGE MultiParamTypeClasses #-&#125;</span></span><br><span class="line"><span class="meta">&#123;-# LANGUAGE ScopedTypeVariables #-&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> LC <span class="keyword">where</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Unbound.Generics.LocallyNameless</span><br><span class="line"><span class="keyword">import</span> Unbound.Generics.LocallyNameless.Internal.Fold (<span class="title">toListOf</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> GHC.Generics</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Data.Typeable (<span class="type">Typeable</span>)</span><br><span class="line"><span class="keyword">import</span> Data.Set <span class="keyword">as</span> S</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Control.Monad.Reader (<span class="type">Reader</span>, <span class="title">runReader</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">data</span> <span class="type">Exp</span></span></span><br><span class="line">  = <span class="type">Var</span> (<span class="type">Name</span> <span class="type">Exp</span>)</span><br><span class="line">  | <span class="type">Lam</span> (<span class="type">Bind</span> (<span class="type">Name</span> <span class="type">Exp</span>) <span class="type">Exp</span>)</span><br><span class="line">  | <span class="type">App</span> <span class="type">Exp</span> <span class="type">Exp</span></span><br><span class="line">  <span class="keyword">deriving</span> (<span class="type">Show</span>, <span class="type">Generic</span>, <span class="type">Typeable</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">instance</span> <span class="type">Alpha</span> <span class="type">Exp</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="keyword">instance</span> <span class="type">Subst</span> <span class="type">Exp</span> <span class="type">Exp</span> <span class="keyword">where</span></span></span><br><span class="line">  isvar (<span class="type">Var</span> x) = <span class="type">Just</span> (<span class="type">SubstName</span> x)</span><br><span class="line">  isvar _       = <span class="type">Nothing</span></span><br><span class="line"></span><br><span class="line"><span class="title">fvSet</span> :: (<span class="type">Alpha</span> a, <span class="type">Typeable</span> b) =&gt; a -&gt; <span class="type">S</span>.<span class="type">Set</span> (<span class="type">Name</span> b)</span><br><span class="line"><span class="title">fvSet</span> = <span class="type">S</span>.fromList . toListOf fv</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">type</span> <span class="type">M</span> a = <span class="type">FreshM</span> a</span></span><br><span class="line"></span><br><span class="line">(=~) :: <span class="type">Exp</span> -&gt; <span class="type">Exp</span> -&gt; <span class="type">M</span> <span class="type">Bool</span></span><br><span class="line"><span class="title">e1</span> =~ e2 | e1 `aeq` e2 = return <span class="type">True</span></span><br><span class="line"><span class="title">e1</span> =~ e2 = <span class="keyword">do</span></span><br><span class="line">    e1' &lt;- red e1</span><br><span class="line">    e2' &lt;- red e2</span><br><span class="line">    <span class="keyword">if</span> e1' `aeq` e1 &amp;&amp; e2' `aeq` e2</span><br><span class="line">      <span class="keyword">then</span> return <span class="type">False</span></span><br><span class="line">      <span class="keyword">else</span> e1' =~ e2'</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Reduction</span></span><br><span class="line"><span class="title">red</span> :: <span class="type">Exp</span> -&gt; <span class="type">M</span> <span class="type">Exp</span></span><br><span class="line"><span class="title">red</span> (<span class="type">App</span> e1 e2) = <span class="keyword">do</span></span><br><span class="line">  e1' &lt;- red e1</span><br><span class="line">  e2' &lt;- red e2</span><br><span class="line">  <span class="keyword">case</span> e1' <span class="keyword">of</span></span><br><span class="line">    <span class="type">Lam</span> bnd -&gt; <span class="keyword">do</span></span><br><span class="line">        (x, e1'') &lt;- unbind bnd</span><br><span class="line">        return $ subst x e2' e1''</span><br><span class="line">    otherwise -&gt; return $ <span class="type">App</span> e1' e2'</span><br><span class="line"><span class="title">red</span> (<span class="type">Lam</span> bnd) = <span class="keyword">do</span></span><br><span class="line">   (x, e) &lt;- unbind bnd</span><br><span class="line">   e' &lt;- red e</span><br><span class="line">   <span class="keyword">case</span> e <span class="keyword">of</span></span><br><span class="line">     <span class="type">App</span> e1 (<span class="type">Var</span> y) | y == x &amp;&amp; x `<span class="type">S</span>.notMember` fvSet e1 -&gt; return e1</span><br><span class="line">     otherwise -&gt; return (<span class="type">Lam</span> (bind x e'))</span><br><span class="line"><span class="title">red</span> (<span class="type">Var</span> x) = return $ (<span class="type">Var</span> x)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title">x</span> :: <span class="type">Name</span> <span class="type">Exp</span></span><br><span class="line"><span class="title">x</span> = string2Name <span class="string">"x"</span></span><br><span class="line"></span><br><span class="line"><span class="title">y</span> :: <span class="type">Name</span> <span class="type">Exp</span></span><br><span class="line"><span class="title">y</span> = string2Name <span class="string">"y"</span></span><br><span class="line"></span><br><span class="line"><span class="title">z</span> :: <span class="type">Name</span> <span class="type">Exp</span></span><br><span class="line"><span class="title">z</span> = string2Name <span class="string">"z"</span></span><br><span class="line"></span><br><span class="line"><span class="title">s</span> :: <span class="type">Name</span> <span class="type">Exp</span></span><br><span class="line"><span class="title">s</span> = string2Name <span class="string">"s"</span></span><br><span class="line"></span><br><span class="line"><span class="title">lam</span> :: <span class="type">Name</span> <span class="type">Exp</span> -&gt; <span class="type">Exp</span> -&gt; <span class="type">Exp</span></span><br><span class="line"><span class="title">lam</span> x y = <span class="type">Lam</span> (bind x y)</span><br><span class="line"></span><br><span class="line"><span class="title">zero</span>  = lam s (lam z (<span class="type">Var</span> z))</span><br><span class="line"><span class="title">one</span>   = lam s (lam z (<span class="type">App</span> (<span class="type">Var</span> s) (<span class="type">Var</span> z)))</span><br><span class="line"><span class="title">two</span>   = lam s (lam z (<span class="type">App</span> (<span class="type">Var</span> s) (<span class="type">App</span> (<span class="type">Var</span> s) (<span class="type">Var</span> z))))</span><br><span class="line"><span class="title">three</span> = lam s (lam z (<span class="type">App</span> (<span class="type">Var</span> s) (<span class="type">App</span> (<span class="type">Var</span> s) (<span class="type">App</span> (<span class="type">Var</span> s) (<span class="type">Var</span> z)))))</span><br><span class="line"></span><br><span class="line"><span class="title">plus</span> = lam x (lam y (lam s (lam z (<span class="type">App</span> (<span class="type">App</span> (<span class="type">Var</span> x) (<span class="type">Var</span> s)) (<span class="type">App</span> (<span class="type">App</span> (<span class="type">Var</span> y) (<span class="type">Var</span> s)) (<span class="type">Var</span> z))))))</span><br><span class="line"></span><br><span class="line"><span class="title">true</span> = lam x (lam y (<span class="type">Var</span> x))</span><br><span class="line"><span class="title">false</span> = lam x (lam y (<span class="type">Var</span> y))</span><br><span class="line"><span class="title">if_</span> x y z = (<span class="type">App</span> (<span class="type">App</span> x y) z)</span><br><span class="line"></span><br><span class="line"><span class="title">main</span> :: <span class="type">IO</span> ()</span><br><span class="line"><span class="title">main</span> = <span class="keyword">do</span></span><br><span class="line">  print $ lam x (<span class="type">Var</span> x) `aeq` lam y (<span class="type">Var</span> y)</span><br><span class="line">  print $ not (lam x (<span class="type">Var</span> y) `aeq` lam x (<span class="type">Var</span> x))</span><br><span class="line">  print $ lam x (<span class="type">App</span> (lam y (<span class="type">Var</span> x)) (lam y (<span class="type">Var</span> y))) =~ (lam y (<span class="type">Var</span> y))</span><br><span class="line">  print $ lam x (<span class="type">App</span> (<span class="type">Var</span> y) (<span class="type">Var</span> x)) =~ <span class="type">Var</span> y</span><br><span class="line">  print $ if_ true (<span class="type">Var</span> x) (<span class="type">Var</span> y) =~ <span class="type">Var</span> x</span><br><span class="line">  print $ if_ false (<span class="type">Var</span> x) (<span class="type">Var</span> y) =~ <span class="type">Var</span> y</span><br><span class="line">  print $ <span class="type">App</span> (<span class="type">App</span> plus one) two =~ three</span><br></pre></td></tr></table></figure>
<p>請看:</p>
<ul>
<li><a href="https://github.com/lambdageek/unbound-generics" target="_blank" rel="noopener">unbound-generics</a></li>
</ul>
<h3 id="pretty"><a href="#pretty" class="headerlink" title="pretty"></a>pretty</h3><p>漂亮的<code>printer</code>组合器组成逻辑来<code>print</code>字符串。</p>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">        <span class="type">Combinators</span></span><br><span class="line"><span class="comment">---------------------</span></span><br><span class="line">&lt;&gt;      <span class="type">Concatenation</span></span><br><span class="line">&lt;+&gt;     间隔连接</span><br><span class="line"><span class="title">char</span>    将字符渲染为文档</span><br><span class="line"><span class="title">text</span>    将字符串渲染为文档</span><br></pre></td></tr></table></figure>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#123;-# LANGUAGE FlexibleInstances #-&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Text.PrettyPrint</span><br><span class="line"><span class="keyword">import</span> Text.Show.Pretty (<span class="title">ppShow</span>)</span><br><span class="line"></span><br><span class="line"><span class="title">parensIf</span> ::  <span class="type">Bool</span> -&gt; <span class="type">Doc</span> -&gt; <span class="type">Doc</span></span><br><span class="line"><span class="title">parensIf</span> <span class="type">True</span> = parens</span><br><span class="line"><span class="title">parensIf</span> <span class="type">False</span> = id</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">type</span> <span class="type">Name</span> = <span class="type">String</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">data</span> <span class="type">Expr</span></span></span><br><span class="line">  = <span class="type">Var</span> <span class="type">String</span></span><br><span class="line">  | <span class="type">Lit</span> <span class="type">Ground</span></span><br><span class="line">  | <span class="type">App</span> <span class="type">Expr</span> <span class="type">Expr</span></span><br><span class="line">  | <span class="type">Lam</span> <span class="type">Name</span> <span class="type">Expr</span></span><br><span class="line">  <span class="keyword">deriving</span> (<span class="type">Eq</span>, <span class="type">Show</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">data</span> <span class="type">Ground</span></span></span><br><span class="line">  = <span class="type">LInt</span> <span class="type">Int</span></span><br><span class="line">  | <span class="type">LBool</span> <span class="type">Bool</span></span><br><span class="line">  <span class="keyword">deriving</span> (<span class="type">Show</span>, <span class="type">Eq</span>, <span class="type">Ord</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="type">Pretty</span> p <span class="keyword">where</span></span></span><br><span class="line">  ppr :: <span class="type">Int</span> -&gt; p -&gt; <span class="type">Doc</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">instance</span> <span class="type">Pretty</span> <span class="type">String</span> <span class="keyword">where</span></span></span><br><span class="line">  ppr _ x = text x</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">instance</span> <span class="type">Pretty</span> <span class="type">Expr</span> <span class="keyword">where</span></span></span><br><span class="line">  ppr _ (<span class="type">Var</span> x)         = text x</span><br><span class="line">  ppr _ (<span class="type">Lit</span> (<span class="type">LInt</span> a))  = text (show a)</span><br><span class="line">  ppr _ (<span class="type">Lit</span> (<span class="type">LBool</span> b)) = text (show b)</span><br><span class="line"></span><br><span class="line">  ppr p e@(<span class="type">App</span> _ _) =</span><br><span class="line">    <span class="keyword">let</span> (f, xs) = viewApp e <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">let</span> args = sep $ map (ppr (p+<span class="number">1</span>)) xs <span class="keyword">in</span></span><br><span class="line">    parensIf (p&gt;<span class="number">0</span>) $ ppr p f &lt;+&gt; args</span><br><span class="line"></span><br><span class="line">  ppr p e@(<span class="type">Lam</span> _ _) =</span><br><span class="line">    <span class="keyword">let</span> body = ppr (p+<span class="number">1</span>) (viewBody e) <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">let</span> vars = map (ppr <span class="number">0</span>) (viewVars e) <span class="keyword">in</span></span><br><span class="line">    parensIf (p&gt;<span class="number">0</span>) $ char '\\' &lt;&gt; hsep vars &lt;+&gt; text <span class="string">"."</span> &lt;+&gt; body</span><br><span class="line"></span><br><span class="line"><span class="title">viewVars</span> :: <span class="type">Expr</span> -&gt; [<span class="type">Name</span>]</span><br><span class="line"><span class="title">viewVars</span> (<span class="type">Lam</span> n a) = n : viewVars a</span><br><span class="line"><span class="title">viewVars</span> _ = []</span><br><span class="line"></span><br><span class="line"><span class="title">viewBody</span> :: <span class="type">Expr</span> -&gt; <span class="type">Expr</span></span><br><span class="line"><span class="title">viewBody</span> (<span class="type">Lam</span> _ a) = viewBody a</span><br><span class="line"><span class="title">viewBody</span> x = x</span><br><span class="line"></span><br><span class="line"><span class="title">viewApp</span> :: <span class="type">Expr</span> -&gt; (<span class="type">Expr</span>, [<span class="type">Expr</span>])</span><br><span class="line"><span class="title">viewApp</span> (<span class="type">App</span> e1 e2) = go e1 [e2]</span><br><span class="line">  <span class="keyword">where</span></span><br><span class="line">    go (<span class="type">App</span> a b) xs = go a (b : xs)</span><br><span class="line">    go f xs = (f, xs)</span><br><span class="line"></span><br><span class="line"><span class="title">ppexpr</span> :: <span class="type">Expr</span> -&gt; <span class="type">String</span></span><br><span class="line"><span class="title">ppexpr</span> = render . ppr <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title">s</span>, k, example :: <span class="type">Expr</span></span><br><span class="line"><span class="title">s</span> = <span class="type">Lam</span> <span class="string">"f"</span> (<span class="type">Lam</span> <span class="string">"g"</span> (<span class="type">Lam</span> <span class="string">"x"</span> (<span class="type">App</span> (<span class="type">Var</span> <span class="string">"f"</span>) (<span class="type">App</span> (<span class="type">Var</span> <span class="string">"g"</span>) (<span class="type">Var</span> <span class="string">"x"</span>)))))</span><br><span class="line"><span class="title">k</span> = <span class="type">Lam</span> <span class="string">"x"</span> (<span class="type">Lam</span> <span class="string">"y"</span> (<span class="type">Var</span> <span class="string">"x"</span>))</span><br><span class="line"><span class="title">example</span> = <span class="type">App</span> s k</span><br><span class="line"></span><br><span class="line"><span class="title">main</span> :: <span class="type">IO</span> ()</span><br><span class="line"><span class="title">main</span> = <span class="keyword">do</span></span><br><span class="line">  putStrLn $ ppexpr s</span><br><span class="line">  putStrLn $ ppShow example</span><br></pre></td></tr></table></figure>
<p><code>k</code>组合器的漂亮打印形式:</p>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\f g x . (f (g x))</span><br></pre></td></tr></table></figure>
<p><code>Text.Show.Pretty</code>库可用于以更易于理解的形式对实现<code>Show</code>的任何类型的嵌套数据结构进行漂亮的輸出。</p>
<p>例如，带有<code>ppShow</code>的<code>SK</code>组合器<code>AST</code>的结构转储。</p>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">App</span></span><br><span class="line">  (<span class="type">Lam</span></span><br><span class="line">     <span class="string">"f"</span> (<span class="type">Lam</span> <span class="string">"g"</span> (<span class="type">Lam</span> <span class="string">"x"</span> (<span class="type">App</span> (<span class="type">Var</span> <span class="string">"f"</span>) (<span class="type">App</span> (<span class="type">Var</span> <span class="string">"g"</span>) (<span class="type">Var</span> <span class="string">"x"</span>))))))</span><br><span class="line">  (<span class="type">Lam</span> <span class="string">"x"</span> (<span class="type">Lam</span> <span class="string">"y"</span> (<span class="type">Var</span> <span class="string">"x"</span>)))</span><br></pre></td></tr></table></figure>
<p>将以下内容添加到<code>ghci.conf</code>中对于交互式地处理深度嵌套的结构可能会很有用。</p>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Text.Show.Pretty (<span class="title">ppShow</span>)</span><br><span class="line"><span class="title">let</span> pprint x = putStrLn $ ppShow x</span><br></pre></td></tr></table></figure>
<p>請看:</p>
<ul>
<li><a href="http://belle.sourceforge.net/doc/hughes95design.pdf" target="_blank" rel="noopener">The Design of a Pretty-printing Library</a></li>
</ul>
<h3 id="wl-pprint-text"><a href="#wl-pprint-text" class="headerlink" title="wl-pprint-text"></a>wl-pprint-text</h3><p><code>wl-pprint-text</code>是<code>Wadler</code>风格的漂亮打印库，它使用<code>Text</code>构建器对象在后台高效生成。</p>
<p>它<code>effectively</code>(有效)地公开了与基于<code>String</code>的漂亮库相同的接口，但性能更高。</p>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Combinators</span></span><br><span class="line"></span><br><span class="line"><span class="title">renderPretty</span> :: <span class="type">Float</span> -&gt; <span class="type">Int</span> -&gt; <span class="type">Doc</span> -&gt; <span class="type">SimpleDoc</span></span><br><span class="line"><span class="title">renderCompact</span> :: <span class="type">Doc</span> -&gt; <span class="type">SimpleDoc</span></span><br><span class="line"><span class="title">renderOneLine</span> :: <span class="type">Doc</span> -&gt; <span class="type">SimpleDoc</span></span><br></pre></td></tr></table></figure>
<p>請看:</p>
<p><strong><em>Monadic API</em></strong></p>
<ul>
<li><a href="https://hackage.haskell.org/package/wl-pprint-text" target="_blank" rel="noopener">wl-pprint-text</a></li>
</ul>
<h3 id="pretty-show"><a href="#pretty-show" class="headerlink" title="pretty-show"></a>pretty-show</h3><blockquote>
<p>TODO</p>
</blockquote>
<h3 id="Haskeline"><a href="#Haskeline" class="headerlink" title="Haskeline"></a>Haskeline</h3><p><code>Haskeline</code>是跨平台的<code>readline</code>支持，对<code>GHCi</code>也很好。<br><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">runInputT</span> :: <span class="type">Settings</span> <span class="type">IO</span> -&gt; <span class="type">InputT</span> <span class="type">IO</span> a -&gt; <span class="type">IO</span> a</span><br><span class="line"><span class="title">getInputLine</span> :: <span class="type">String</span> -&gt; <span class="type">InputT</span> <span class="type">IO</span> (<span class="type">Maybe</span> <span class="type">String</span>)</span><br><span class="line"><span class="keyword">import</span> Control.Monad.Trans</span><br><span class="line"><span class="keyword">import</span> System.Console.Haskeline</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">type</span> <span class="type">Repl</span> a = <span class="type">InputT</span> <span class="type">IO</span> a</span></span><br><span class="line"></span><br><span class="line"><span class="title">process</span> :: <span class="type">String</span> -&gt; <span class="type">IO</span> ()</span><br><span class="line"><span class="title">process</span> = putStrLn</span><br><span class="line"></span><br><span class="line"><span class="title">repl</span> :: <span class="type">Repl</span> ()</span><br><span class="line"><span class="title">repl</span> = <span class="keyword">do</span></span><br><span class="line">  minput &lt;- getInputLine <span class="string">"Repl&gt; "</span></span><br><span class="line">  <span class="keyword">case</span> minput <span class="keyword">of</span></span><br><span class="line">    <span class="type">Nothing</span> -&gt; outputStrLn <span class="string">"Goodbye."</span></span><br><span class="line">    <span class="type">Just</span> input -&gt; (liftIO $ process input) &gt;&gt; repl</span><br><span class="line"></span><br><span class="line"><span class="title">main</span> :: <span class="type">IO</span> ()</span><br><span class="line"><span class="title">main</span> = runInputT defaultSettings repl</span><br></pre></td></tr></table></figure></p>
<h3 id="Repline"><a href="#Repline" class="headerlink" title="Repline"></a>Repline</h3><p>构建命令行<code>REPL</code>接口中的某些任务是如此普遍，以至于将它们抽象到库中变得很有用。</p>
<p>尽管<code>haskeline</code>提供了一个明智的用于与<code>GNU readline</code>交互的较低级<code>API</code>，但是一遍又一遍地实现<code>tab completion</code>(命令補全)逻辑和通用命令逻辑有些繁琐。</p>
<p>为此，<code>Repline</code>协助构建类似于<code>GHCi</code>的默认行为的交互式<code>shell</code>.</p>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Main <span class="keyword">where</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Control.Monad.Trans</span><br><span class="line"><span class="keyword">import</span> System.Console.Repline</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Data.List (<span class="title">isPrefixOf</span>)</span><br><span class="line"><span class="keyword">import</span> System.Process (<span class="title">callCommand</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">type</span> <span class="type">Repl</span> a = <span class="type">HaskelineT</span> <span class="type">IO</span> a</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Evaluation : 处理每行用户输入</span></span><br><span class="line"><span class="title">cmd</span> :: <span class="type">String</span> -&gt; <span class="type">Repl</span> ()</span><br><span class="line"><span class="title">cmd</span> input = liftIO $ print input</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Tab Completion: 返回输入的部分单词的补全</span></span><br><span class="line"><span class="title">completer</span> :: <span class="type">Monad</span> m =&gt; <span class="type">WordCompleter</span> m</span><br><span class="line"><span class="title">completer</span> n = <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">let</span> names = [<span class="string">"kirk"</span>, <span class="string">"spock"</span>, <span class="string">"mccoy"</span>]</span><br><span class="line">  return $ filter (isPrefixOf n) names</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Commands</span></span><br><span class="line"><span class="title">help</span> :: [<span class="type">String</span>] -&gt; <span class="type">Repl</span> ()</span><br><span class="line"><span class="title">help</span> args = liftIO $ print $ <span class="string">"Help: "</span> ++ show args</span><br><span class="line"></span><br><span class="line"><span class="title">say</span> :: [<span class="type">String</span>] -&gt; <span class="type">Repl</span> ()</span><br><span class="line"><span class="title">say</span> args = <span class="keyword">do</span></span><br><span class="line">  _ &lt;- liftIO $ callCommand $ <span class="string">"cowsay"</span> ++ <span class="string">" "</span> ++ (unwords args)</span><br><span class="line">  return ()</span><br><span class="line"></span><br><span class="line"><span class="title">options</span> :: [(<span class="type">String</span>, [<span class="type">String</span>] -&gt; <span class="type">Repl</span> ())]</span><br><span class="line"><span class="title">options</span> = [</span><br><span class="line">    (<span class="string">"help"</span>, help)  <span class="comment">-- :help</span></span><br><span class="line">  , (<span class="string">"say"</span>, say)    <span class="comment">-- :say</span></span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line"><span class="title">ini</span> :: <span class="type">Repl</span> ()</span><br><span class="line"><span class="title">ini</span> = liftIO $ putStrLn <span class="string">"Welcome!"</span></span><br><span class="line"></span><br><span class="line"><span class="title">repl</span> :: <span class="type">IO</span> ()</span><br><span class="line"><span class="title">repl</span> = evalRepl <span class="string">"&gt;&gt;&gt; "</span> cmd options (<span class="type">Word0</span> completer) ini</span><br><span class="line"></span><br><span class="line"><span class="title">main</span> :: <span class="type">IO</span> ()</span><br><span class="line"><span class="title">main</span> = repl</span><br></pre></td></tr></table></figure>
<p>尝试一下.(<code>&lt;TAB&gt;</code>表示用户按键)</p>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ runhaskell <span class="type">Simple</span>.hs</span><br><span class="line"><span class="meta"># Or if in a sandbox: cabal exec runhaskell Simple.hs</span></span><br><span class="line"><span class="type">Welcome</span>!</span><br><span class="line">&gt;&gt;&gt; &lt;<span class="type">TAB</span>&gt;</span><br><span class="line"><span class="title">kirk</span> spock mccoy</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; k&lt;<span class="type">TAB</span>&gt;</span><br><span class="line"><span class="title">kirk</span></span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; spam</span><br><span class="line"><span class="string">"spam"</span></span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; :say <span class="type">Hello</span> <span class="type">Haskell</span></span><br><span class="line"> _______________</span><br><span class="line">&lt; <span class="type">Hello</span> <span class="type">Haskell</span> &gt;</span><br><span class="line"> <span class="comment">---------------</span></span><br><span class="line">        \   ^__^</span><br><span class="line">         \  (oo)\_______</span><br><span class="line">            (__)\       )\/\</span><br><span class="line">                ||<span class="comment">----w |</span></span><br><span class="line">                ||     ||</span><br></pre></td></tr></table></figure>
<p>請看:</p>
<ul>
<li><a href="https://github.com/sdiehl/repline" target="_blank" rel="noopener">repline</a></li>
</ul>

        
            <div class="donate-container">
    <div class="donate-button">
        <button id="donate-button">赞赏</button>
    </div>
    <div class="donate-img-container hide" id="donate-img-container">
        <img id="donate-img" src="" data-src="/blog/img/pay.png">
        <p> 感谢鼓励 </p>
    </div>
</div>
        
        <div id="comment-container">
        </div>
    </div>
</div>
    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        

        

    </ul>
    
    <p>
        <span>/</span>
        
        <span><a href="https://medium.com/netflix-techblog">Netflix</a></span>
        <span>/</span>
        
        <span><a href="https://engineering.linkedin.com/blog">Linkedin</a></span>
        <span>/</span>
        
        <span><a href="https://blogs.dropbox.com/tech/">Dropbox</a></span>
        <span>/</span>
        
        <span><a href="https://code.fb.com/">Facebook</a></span>
        <span>/</span>
        
        <span><a href="https://www.fpcomplete.com/blog">FPComplete</a></span>
        <span>/</span>
        
        <span><a href="https://blog.janestreet.com/">JaneStreet</a></span>
        <span>/</span>
        
        <span><a href="https://github.com/limengyu1990/">Github</a></span>
        <span>/</span>
        
    </p>
    
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>
        Created By <a href="https://hexo.io/">Hexo</a>  Theme <a href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a></p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.json"
    window.hexo_root = "/blog/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="/blog/js/index.js"></script>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script src="/blog/js/gitment.js"></script>
<script>
    var gitment = new Gitment({
        id: 'Haskell-Languages',
        owner: 'limengyu1990',
        repo: 'hexo-blog',
        oauth: {
            client_id: '7cfc73dd62b57f07ed83',
            client_secret: 'dd03b7e54aadf0d81e4c9c93e23a41272bcfcfa1',
        },
    })
    gitment.render('comment-container')
</script>

</html>
